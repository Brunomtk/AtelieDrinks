@model IEnumerable<AtelieDrinks.Models.Orcamento>

@{
    ViewData["Title"] = "Index2";
}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/css/orcamento.css">

    <title>Orcamento 2</title>
</head>
<body>
    <!--hero-banner-->
    <div class="hero-banner orcamento-banner">
        <h1 class="title-banner">Orcamento</h1>
        <h3>Passo 2</h3>
    </div>

    <!--content-->
    <div class="black-box">
        <div class="content">
            <!--box-->
            <div class="content-box scroll">
                <div style="margin: 350px 0 50px 0;" class="margin-box">
                    <h3>CUSTOS OPERACIONAIS</h3>
                    <p style="margin-top:5px">Profissões gerais, coordenadores, transportadores, etc...</p>

                    <div class="row-inputs">

                        <div class="list-inputs">
                            <!--Lista COORDENADOR-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdCoordenador" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Coordenador</p>
                            <div class="form-input" style="left: 30%">
                                <!--Input Valor-->
                                <input id="valorCoordenador" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 30%">
                                <!--Input Total-->
                                <input id="totalCoordenador" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista COORDENADOR-->

                        <div class="list-inputs">
                            <!--Lista PROFISSIONAIS GERAIS-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdProfissionaisGerias" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Profissionais Gerais</p>
                            <div class="form-input" style="left: 17%">
                                <!--Input Valor-->
                                <input id="valorProfissionaisGerias" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 17%">
                                <!--Input Total-->
                                <input id="totalProfissionaisGerias" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista PROFISSIONAIS GERAIS-->

                        <div class="list-inputs">
                            <!--Lista BALCÕES-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdBalcoes" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Balcões</p>
                            <div class="form-input" style="left: 39%">
                                <!--Input Valor-->
                                <input id="valorBalcoes" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 39%">
                                <!--Input Total-->
                                <input id="totalBalcoes" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista BALCÕES-->

                        <div class="list-inputs">
                            <!--Lista IMPOSTOS FEDERAIS-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdImpostosFederais" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Impostos Federais</p>
                            <div class="form-input" style="left: 20%">
                                <!--Input Valor-->
                                <input id="valorImpostosFederais" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 20%">
                                <!--Input Total-->
                                <input id="totalImpostosFederais" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista IMPOSTOS FEDERAIS-->

                        <div class="list-inputs">
                            <!--Lista SEGURO DE RESERVA-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdSeguroReserva" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Seguro de Reserva</p>
                            <div class="form-input" style="left: 20%">
                                <!--Input Valor-->
                                <input id="valorSeguroReserva" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 20%">
                                <!--Input Total-->
                                <input id="totalSeguroReserva" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista SEGURO DE RESERVA-->

                        <div class="list-inputs">
                            <!--Lista TAXA OP-->
                            <div class="form-input" style="width:45px">
                                <!--Input QTD-->
                                <input id="qtdTaxaOp" required="">
                                <label><span>QTD</span></label>
                            </div>
                            <p class="list-input-content">Taxa de Operacionalização</p>
                            <div class="form-input" style="left: 5%">
                                <!--Input Valor-->
                                <input id="valorTaxaOp" required="">
                                <label><span>Valor</span></label>
                            </div>
                            <div class="form-input" style="left: 5%">
                                <!--Input Total-->
                                <input id="totalTaxaOp" required="">
                                <label><span>Total</span></label>
                            </div>
                        </div> <!--Fim lista TAXA OP-->

                    </div> <!--Fim row-inputs-->

                </div> <!--Fim margin-box-->

            </div> <!--fim content box-->

            <div class="list-buttons">
                <button class="button excluir" onclick="window.location='@Url.Action("Index", "Orcamento", new { numberPage = 1 })'">Voltar</button>
                @*<button class="button continuar" onclick="window.location='@Url.Action("Index", "Orcamento", new { numberPage = 3 })'">Continuar</button>*@
                <button id="button continuar" class="button continuar">Continuar</button>

            </div>

        </div> <!--fim CONTENT-->
    </div>  <!--fim BLACKBOX-->
</body>
</html>



<script>
    $(document).ready(function () {

        $('.list-inputs').on('input', 'input[id^="valor"]', function () {
            var $listInputs = $(this).closest('.list-inputs');
            var qtd = parseInt($listInputs.find('input[id^="qtd"]').val());
            var valor = $listInputs.find('input[id^="valor"]').val();

            var digitsOnly = valor.replace(/[^\d]/g, '');
            if (digitsOnly === '') {
                digitsOnly = '0';
            }

            var valorFormatted = parseFloat(digitsOnly.slice(0, -2) + '.' + digitsOnly.slice(-2));
            if (isNaN(valorFormatted)) {
                valorFormatted = 0;
            }

            var valorFormattedString = 'R$' + valorFormatted.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            $listInputs.find('input[id^="valor"]').val(valorFormattedString);
            $listInputs.find('label[id^="valor-label"]').text(valorFormattedString);

            var total = qtd * valorFormatted;
            if (isNaN(total)) {
                total = 0;
            }
            var totalFormattedString = 'R$' + total.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
            $listInputs.find('input[id^="total"]').val(totalFormattedString);
            $listInputs.find('label[id^="total-label"]').text(totalFormattedString);
        });





        $('#button_continuar').click(function () {
            var qtdCoordenador = parseInt($('#qtdCoordenador').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorCoordenador').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalCoordenador').val().replace(',', '.'));

            var qtdCoordenador = parseFloat($('#qtdProfissionaisGerias').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorProfissionaisGerias').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalProfissionaisGerias').val().replace(',', '.'));

            var qtdCoordenador = parseFloat($('#qtdBalcoes').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorBalcoes').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalBalcoes').val().replace(',', '.'));

            var qtdCoordenador = parseFloat($('#qtdImpostosFederais').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorImpostosFederais').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalImpostosFederais').val().replace(',', '.'));

            var qtdCoordenador = parseFloat($('#qtdSeguroReserva').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorSeguroReserva').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalSeguroReserva').val().replace(',', '.'));

            var qtdCoordenador = parseFloat($('#qtdTaxaOp').val().replace(',', '.'));
            var valorCoordenador = parseFloat($('#valorTaxaOp').val().replace(',', '.'));
            var totalCoordenador = parseFloat($('#totalTaxaOp').val().replace(',', '.'));

            if (!isNaN(qtdCoordenador) && !isNaN(valorCoordenador) && !isNaN(totalCoordenador)) {
                $.post({
                    url: '@Url.Action("Create_custosOp", "Orcamento")',
                    data: {
                        qtdCoordenador: qtdCoordenador,
                        valorCoordenador: valorCoordenador,
                        totalCoordenador: totalCoordenador,
                        qtdProfissionaisGerais: qtdProfissionaisGerais,
                        valorProfissionaisGerais: valorProfissionaisGerais,
                        totalProfissionaisGerais: totalProfissionaisGerais,
                        qtdBalcoes: qtdBalcoes,
                        valorBalcoes: valorBalcoes,
                        totalBalcoes: totalBalcoes,
                        qtdImpostosFederais: qtdImpostosFederais,
                        valorImpostosFederais: valorImpostosFederais,
                        totalImpostosFederais: totalImpostosFederais,
                        qtdSeguroReserva: qtdSeguroReserva,
                        valorSeguroReserva: valorSeguroReserva,
                        totalSeguroReserva: totalSeguroReserva,
                        qtdTaxaOp: qtdTaxaOp,
                        valorTaxaOp: valorTaxaOp,
                        totalTaxaOp: totalTaxaOp
                    },
                    success: function () {
                        console.log("Dados enviados com sucesso.");
                        var url = '@Url.Action("Index", "Orcamento", new { numberPage = 3 })';
                        window.location.href = url;
                    },
                    error: function () {
                        console.log('Ocorreu um erro ao enviar os dados para a controller.');
                    }
                });
            } else {
                console.log('Preencha todos os campos obrigatórios.');
            }
        });

        function formatMoney(value) {
            var formatter = new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });

            return formatter.format(value);
        }
    });

</script>
